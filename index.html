<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Grid Map Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .control-group {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select, button {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            background: #4CAF50;
            color: white;
            cursor: pointer;
            margin-right: 10px;
        }

        button:hover {
            background: #45a049;
        }

        .grid-container {
            border: 2px solid #333;
            margin: 20px 0;
            background: white;
            width: 100%;
            height: 70vh;
            overflow: auto;
            position: relative;
        }

        .grid-wrapper {
            transform-origin: top left;
            transition: transform 0.2s ease;
        }

        .grid {
            display: grid;
            gap: 1px;
            background: #ccc;
        }

        .cell {
            width: var(--cell-size, 25px);
            height: var(--cell-size, 25px);
            border: 1px solid #ddd;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: calc(var(--cell-size, 25px) * 0.3);
            background: white;
            position: relative;
            min-width: 8px;
            min-height: 8px;
            user-select: none;
            -webkit-user-select: none;  /* Safari */
            -ms-user-select: none;
        }

        .cell:hover {
            background: #e0e0e0;
        }

        .cell.selected {
            background: #007bff;
            color: white;
        }

        .brush-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: end;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .brush-options .control-group {
            margin-right: 0;
            margin-bottom: 0;
        }

        #currentBrushDisplay {
            padding: 8px 12px;
            background: #e9ecef;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-weight: bold;
            color: #495057;
        }

        .export-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .csv-output {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }

        .preset-buttons {
            margin-bottom: 15px;
        }

        .preset-buttons button {
            background: #17a2b8;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .preset-buttons button:hover {
            background: #138496;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Game Grid Map Editor</h1>

    <div class="controls">
        <div class="control-group">
            <label>Grid Size:</label>
            <input type="number" id="gridSize" value="20" min="5" max="100">
            <button onclick="updateGridSize()">Update Grid</button>
        </div>

        <div class="control-group">
            <label>Zoom:</label>
            <input type="range" id="zoomSlider" min="0.1" max="2" step="0.1" value="1" oninput="updateZoom()">
            <span id="zoomValue">100%</span>
            <button onclick="resetZoom()">Reset Zoom</button>
        </div>

        <div class="preset-buttons">
            <button onclick="clearGrid()">Clear All</button>
        </div>
    </div>

    <div class="brush-options">
        <div class="control-group">
            <label>Obj Brush:</label>
            <select id="objBrush" onchange="updateBrush()">
                <option value="">None</option>
                <option value="Obj 0">Obj 0</option>
                <option value="Obj 1">Obj 1</option>
                <option value="Obj 2">Obj 2</option>
                <option value="Obj 3">Obj 3</option>
                <option value="Obj 4">Obj 4</option>
                <option value="Obj 5">Obj 5</option>
                <option value="Obj 6">Obj 6</option>
                <option value="Obj 7">Obj 7</option>
                <option value="Obj 8">Obj 8</option>
                <option value="Obj 9">Obj 9</option>
            </select>
        </div>
        <div class="control-group">
            <label>Lvl Brush:</label>
            <select id="lvlBrush" onchange="updateBrush()">
                <option value="">None</option>
                <option value="Lvl 0">Lvl 0</option>
                <option value="Lvl 1">Lvl 1</option>
                <option value="Lvl 2">Lvl 2</option>
                <option value="Lvl 3">Lvl 3</option>
                <option value="Lvl 4">Lvl 4</option>
                <option value="Lvl 5">Lvl 5</option>
                <option value="Lvl 6">Lvl 6</option>
                <option value="Lvl 7">Lvl 7</option>
                <option value="Lvl 8">Lvl 8</option>
                <option value="Lvl 9">Lvl 9</option>

            </select>
        </div>
        <div class="control-group">
            <label>Current Brush:</label>
            <span id="currentBrushDisplay">None</span>
            <button onclick="clearBrush()">Clear Brush</button>
        </div>
    </div>

    <div class="grid-container">
        <div class="grid-wrapper" id="gridWrapper">
            <div class="grid" id="gameGrid"></div>
        </div>
    </div>

    <div class="export-section">
        <h3>Export</h3>
        <button onclick="exportToGoogleSheetText()">Generate Text for Google Sheets</button>

        <textarea class="csv-output" id="csvOutput" placeholder="CSV output will appear here..."></textarea>
    </div>
</div>

<script>
    let gridSize = 20;
    let currentBrush = '';
    let isDrawing = false;
    let gridData = {};
    let currentZoom = 1;

    function updateBrush() {
        const objBrush = document.getElementById('objBrush').value;
        const lvlBrush = document.getElementById('lvlBrush').value;

        // Combine brushes based on selection
        let brushParts = [];
        if (objBrush) brushParts.push(objBrush);
        if (lvlBrush) brushParts.push(lvlBrush);

        currentBrush = brushParts.join(', ');

        // Update display
        document.getElementById('currentBrushDisplay').textContent = currentBrush || 'None';
        document.getElementById('currentBrushDisplay').style.background = getBrushColor(currentBrush);
        document.getElementById('currentBrushDisplay').style.color = currentBrush ? 'white' : '#495057';
    }

    function clearBrush() {
        document.getElementById('objBrush').value = '';
        document.getElementById('lvlBrush').value = '';
        updateBrush();
    }

    function updateGridSize() {
        gridSize = parseInt(document.getElementById('gridSize').value);
        updateCellSize();
        createGrid();
    }

    function updateZoom() {
        currentZoom = parseFloat(document.getElementById('zoomSlider').value);
        document.getElementById('zoomValue').textContent = Math.round(currentZoom * 100) + '%';
        updateCellSize();
    }

    function resetZoom() {
        currentZoom = 1;
        document.getElementById('zoomSlider').value = 1;
        document.getElementById('zoomValue').textContent = '100%';
        updateCellSize();
    }

    function updateCellSize() {
        // Calculate appropriate cell size based on grid size and zoom
        let baseSize = Math.max(8, Math.min(30, 600 / gridSize));
        let cellSize = baseSize * currentZoom;

        document.documentElement.style.setProperty('--cell-size', cellSize + 'px');

        const wrapper = document.getElementById('gridWrapper');
        if (wrapper) {
            wrapper.style.transform = `scale(1)`;
        }
    }

    function createGrid() {
        const grid = document.getElementById('gameGrid');
        grid.innerHTML = '';
        grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
        gridData = {};

        updateCellSize();

        for (let row = 0; row < gridSize; row++) {
            for (let col = 0; col < gridSize; col++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = 'Obj 0'
                cell.dataset.row = row;
                cell.dataset.col = col;
                cell.addEventListener('mousedown', startDrawing);
                cell.addEventListener('mouseenter', continueDrawing);
                cell.addEventListener('mouseup', stopDrawing);
                grid.appendChild(cell);
                cell.style.background = getBrushColor(cell.textContent);
                cell.style.color = cell.textContent ? 'white' : 'black';
                
                const key = `${row},${col}`;
                gridData[key] = 'Obj 0';
            }
        }
    }

    function selectBrush(brushType) {
        // This function is no longer needed but keeping for compatibility
        currentBrush = brushType;
        updateBrush();
    }

    function startDrawing(e) {
        isDrawing = true;
        paintCell(e.target);
    }

    function continueDrawing(e) {
        if (isDrawing) {
            paintCell(e.target);
        }
    }

    function stopDrawing() {
        isDrawing = false;
    }

    function paintCell(cell) {
        const row = cell.dataset.row;
        const col = cell.dataset.col;
        const key = `${row},${col}`;

        gridData[key] = currentBrush;

        // Adjust text display based on cell size
        const cellSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-size'));
        if (cellSize >= 15) {
            cell.textContent = currentBrush ? (currentBrush.length > 8 ? currentBrush.substring(0, 6) + '...' : currentBrush) : '';
        } else {
            cell.textContent = currentBrush ? currentBrush.charAt(0) : '';
        }

        // Visual feedback
        cell.style.background = getBrushColor(currentBrush);
        cell.style.color = currentBrush ? 'white' : 'black';
    }

    function getBrushColor(brush) {
        if (!brush) return '#ffffff';

        const colors = {
            // Objs
            'Obj 1': '#ff6b6b',
            'Obj 2': '#4ecdc4',
            'Obj 3': '#fcbf49',
            'Obj 4': '#a29bfe',
            'Obj 5': '#fd79a8',
            'Obj 6': '#00cec9',
            'Obj 7': '#fab1a0',
            'Obj 8': '#6c5ce7',
            'Obj 9': '#55efc4',
            'Obj 0': '#ffeaa7',

            // Lvls
            'Lvl 1': '#45b7d1',
            'Lvl 2': '#96ceb4',
            'Lvl 3': '#f67280',
            'Lvl 4': '#c06c84',
            'Lvl 5': '#6c5b7b',
            'Lvl 6': '#355c7d',
            'Lvl 7': '#ffb347',
            'Lvl 8': '#b2bec3',
            'Lvl 9': '#74b9ff',
            'Lvl 0': '#dfe6e9',

            // Obj + Lvl combos
            'Obj 1, Lvl 1': '#ff8a65',
            'Obj 1, Lvl 2': '#ffb74d',
            'Obj 1, Lvl 3': '#ffd54f',
            'Obj 1, Lvl 4': '#d4e157',
            'Obj 1, Lvl 5': '#aed581',
            'Obj 1, Lvl 6': '#81c784',
            'Obj 1, Lvl 7': '#4db6ac',
            'Obj 1, Lvl 8': '#4dd0e1',
            'Obj 1, Lvl 9': '#4fc3f7',
            'Obj 1, Lvl 0': '#9575cd',

            'Obj 2, Lvl 1': '#ba68c8',
            'Obj 2, Lvl 2': '#f06292',
            'Obj 2, Lvl 3': '#e57373',
            'Obj 2, Lvl 4': '#f48fb1',
            'Obj 2, Lvl 5': '#ce93d8',
            'Obj 2, Lvl 6': '#b39ddb',
            'Obj 2, Lvl 7': '#90caf9',
            'Obj 2, Lvl 8': '#a5d6a7',
            'Obj 2, Lvl 9': '#80cbc4',
            'Obj 2, Lvl 0': '#e6ee9c',

            'Obj 3, Lvl 1': '#ff6f91',
            'Obj 3, Lvl 2': '#ff9671',
            'Obj 3, Lvl 3': '#ffc75f',
            'Obj 3, Lvl 4': '#f9f871',
            'Obj 3, Lvl 5': '#a5dee5',
            'Obj 3, Lvl 6': '#b5ead7',
            'Obj 3, Lvl 7': '#c7ceea',
            'Obj 3, Lvl 8': '#d5aaff',
            'Obj 3, Lvl 9': '#f7d794',
            'Obj 3, Lvl 0': '#ea8685',

            'Obj 4, Lvl 1': '#ff9ff3',
            'Obj 4, Lvl 2': '#feca57',
            'Obj 4, Lvl 3': '#ff6b6b',
            'Obj 4, Lvl 4': '#48dbfb',
            'Obj 4, Lvl 5': '#1dd1a1',
            'Obj 4, Lvl 6': '#f368e0',
            'Obj 4, Lvl 7': '#ff9f43',
            'Obj 4, Lvl 8': '#00d2d3',
            'Obj 4, Lvl 9': '#10ac84',
            'Obj 4, Lvl 0': '#c8d6e5',

            'Obj 5, Lvl 1': '#e84393',
            'Obj 5, Lvl 2': '#fdcb6e',
            'Obj 5, Lvl 3': '#00b894',
            'Obj 5, Lvl 4': '#e17055',
            'Obj 5, Lvl 5': '#6c5ce7',
            'Obj 5, Lvl 6': '#ffeaa7',
            'Obj 5, Lvl 7': '#fab1a0',
            'Obj 5, Lvl 8': '#0984e3',
            'Obj 5, Lvl 9': '#fd79a8',
            'Obj 5, Lvl 0': '#81ecec',

            'Obj 6, Lvl 1': '#d63031',
            'Obj 6, Lvl 2': '#e17055',
            'Obj 6, Lvl 3': '#00cec9',
            'Obj 6, Lvl 4': '#fd79a8',
            'Obj 6, Lvl 5': '#6c5ce7',
            'Obj 6, Lvl 6': '#ffeaa7',
            'Obj 6, Lvl 7': '#55efc4',
            'Obj 6, Lvl 8': '#74b9ff',
            'Obj 6, Lvl 9': '#a29bfe',
            'Obj 6, Lvl 0': '#fdcb6e',

            'Obj 7, Lvl 1': '#9b59b6',
            'Obj 7, Lvl 2': '#3498db',
            'Obj 7, Lvl 3': '#2ecc71',
            'Obj 7, Lvl 4': '#e74c3c',
            'Obj 7, Lvl 5': '#1abc9c',
            'Obj 7, Lvl 6': '#f1c40f',
            'Obj 7, Lvl 7': '#e67e22',
            'Obj 7, Lvl 8': '#95a5a6',
            'Obj 7, Lvl 9': '#34495e',
            'Obj 7, Lvl 0': '#7f8c8d',

            'Obj 8, Lvl 1': '#8e44ad',
            'Obj 8, Lvl 2': '#2980b9',
            'Obj 8, Lvl 3': '#27ae60',
            'Obj 8, Lvl 4': '#c0392b',
            'Obj 8, Lvl 5': '#16a085',
            'Obj 8, Lvl 6': '#f39c12',
            'Obj 8, Lvl 7': '#d35400',
            'Obj 8, Lvl 8': '#bdc3c7',
            'Obj 8, Lvl 9': '#2c3e50',
            'Obj 8, Lvl 0': '#ecf0f1',

            'Obj 9, Lvl 1': '#1abc9c',
            'Obj 9, Lvl 2': '#2ecc71',
            'Obj 9, Lvl 3': '#3498db',
            'Obj 9, Lvl 4': '#9b59b6',
            'Obj 9, Lvl 5': '#34495e',
            'Obj 9, Lvl 6': '#f1c40f',
            'Obj 9, Lvl 7': '#e67e22',
            'Obj 9, Lvl 8': '#e74c3c',
            'Obj 9, Lvl 9': '#ecf0f1',
            'Obj 9, Lvl 0': '#95a5a6',

            'Obj 0, Lvl 1': '#b71540',
            'Obj 0, Lvl 2': '#1e3799',
            'Obj 0, Lvl 3': '#38ada9',
            'Obj 0, Lvl 4': '#6a89cc',
            'Obj 0, Lvl 5': '#60a3bc',
            'Obj 0, Lvl 6': '#82ccdd',
            'Obj 0, Lvl 7': '#b8e994',
            'Obj 0, Lvl 8': '#78e08f',
            'Obj 0, Lvl 9': '#fa983a',
            'Obj 0, Lvl 0': '#e58e26',
        };

        return colors[brush] || '#e9ecef';
    }


    function clearGrid() {
        gridData = {};
        document.querySelectorAll('.cell').forEach(cell => {
            cell.textContent = '';
            cell.style.background = 'white';
            cell.style.color = 'black';
        });
    }

    function exportToCSV() {
        let csv = '';
        for (let row = 0; row < gridSize; row++) {
            let rowData = [];
            for (let col = 0; col < gridSize; col++) {
                const key = `${row},${col}`;
                rowData.push(gridData[key] || '');
            }
            csv += rowData.map(cell => `"${cell}"`).join(',') + '\n';
        }
        document.getElementById('csvOutput').value = csv;
    }

    function exportToGoogleSheetText() {
        let text = '';
        for (let row = 0; row < gridSize; row++) {
            let rowData = [];
            for (let col = 0; col < gridSize; col++) {
                const key = `${row},${col}`;
                rowData.push(gridData[key] || '');
            }
            text += rowData.join('\t') + '\n'; // use tab instead of comma
        }
        document.getElementById('csvOutput').value = text.trim();
    }

    // Initialize grid
    createGrid();
    updateBrush(); // Initialize brush display

    // Prevent context menu on right click
    document.addEventListener('contextmenu', e => e.preventDefault());
</script>
</body>
</html>